<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper SYSTEM "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bhidi.lincang.dao.UserManagementMapper">
    <!--List<String> selectRoles();-->
    <select id="selectRoles" resultType="String">
        SELECT rolename
        FROM role
    </select>
    <!--List<UnitAndDepartments> selectUnitAndDepartment();-->
    <select id="selectUnitAndDepartment" resultType="com.bhidi.lincang.bean.UnitAndDepartment">
        SELECT unit,department
        FROM unitanddepartment
    </select>
    <!--int selectDept(RegisterInfo ri);-->
    <select id="selectDept" parameterType="com.bhidi.lincang.bean.RegisterInfo" resultType="int">
        SELECT id
        FROM unitanddepartment
        WHERE unit = #{unit} and department = #{department}
    </select>
    <!--int saveUser(RegisterInfo ri);-->
    <insert  id="saveUser" parameterType="com.bhidi.lincang.bean.RegisterInfo" useGeneratedKeys="true"
             keyProperty="id">
        INSERT INTO user (username,pass,name,phone1,dept,created_at)
        VALUES ( #{username},#{pass},#{name},#{phone},#{department},#{created_at} )
    </insert >
    <!--int selectRoleid(RegisterInfo ri);-->
    <select id="selectRoleid" parameterType="com.bhidi.lincang.bean.RegisterInfo" resultType="int">
        SELECT id
        FROM role
        WHERE rolename = #{role}
    </select>
    <!--int insertUserRole(Map<String, Object> mapConditionCondition);-->
    <insert id="insertUserRole" parameterType="Map" useGeneratedKeys="true"
             keyProperty="id">
        INSERT INTO user_role (userid,roleid)
        VALUES ( #{userid},#{roleid} )
    </insert >
    <!--RegisterInfo selectRegisterInfoById(int id);-->
    <select id="selectRegisterInfoById" parameterType="int" resultType="com.bhidi.lincang.bean.RegisterInfo">
        SELECT IFNULL(u.id,'')AS id,IFNULL(u.username,'')AS username,
            IFNULL(u.pass,'')AS pass,IFNULL(r.rolename,'') AS role,
            IFNULL(u.name,'') AS name,IFNULL(ud.unit,'') AS unit,
            IFNULL(ud.department,'') AS department,IFNULL(u.phone1,'')AS phone
        FROM user u,user_role ur,role r,unitanddepartment ud
        WHERE u.ID = ur.userid AND ur.roleid = r.id AND u.DEPT=ud.id AND u.id = #{id}
    </select>
    <!--int updateUser(RegisterInfo ri);-->
    <update id="updateUser" parameterType="com.bhidi.lincang.bean.RegisterInfo" >
        UPDATE user
        <trim prefix="set" suffixOverrides=",">
            <if test="pass!=null">pass = #{pass},</if>
            <if test="name!=null">name = #{name},</if>
            <if test="department!=null">dept = #{department},</if>
            <if test="phone!=null">phone1 = #{phone},</if>
        </trim>
        WHERE id = #{id}
    </update>
    <!--int updateUserRole(Map<String, Object> mapConditionCondition);-->
    <update id="updateUserRole" parameterType="com.bhidi.lincang.bean.RegisterInfo" >
        UPDATE user_role
        <trim prefix="set" suffixOverrides=",">
            <if test="roleid!=null">roleid = #{roleid},</if>
        </trim>
        WHERE userid = #{userid}
    </update>
    <!--int deleteRegisterInfoById(int id);-->
    <delete id="deleteRegisterInfoById" >
        DELETE FROM user WHERE id = #{id}
    </delete>
</mapper>
